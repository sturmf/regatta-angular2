// We try to model security with role based access control https://cloud.google.com/firestore/docs/solutions/role-based-access

service cloud.firestore {
  match /databases/{database}/documents {

    match /sailing_clubs/{sailingClub} {
      function isSignedIn() {
        return request.auth != null;
      }

      function getRole() {
        return value(/databases/$(database)/documents/sailing_clubs/$(sailingClub)).roles[request.auth.uid];
      }

      function isOneOfRoles(array) {
        return isSignedIn() && (getRole() in array);
      }

      function isValidNewSailingClub() {
        // Valid if story does not exist and the story has the user as owner.
        return !exists(/databases/$(database)/documents/sailing_clubs/$(sailingClub))
          && request.resource.data.roles[request.auth.uid] == 'owner';
       }

      // Everyone can read the first level
      allow read;

      // Everyone can create a new sailing club or edit if he is the owner
      allow write: if true; //isValidNewSailingClub () || isOneOfRoles(['owner']);
    }

  }
}
